<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì›¹ ë‚±ë§ ì ìˆ˜ ê³„ì‚°ê¸°</title>
  <style>
    :root { --fg:#0f172a; --bg:#fff; --muted:#64748b; --accent:#2563eb; --soft:#f1f5f9; }
    *{box-sizing:border-box}
    body{margin:0; font-family:ui-sans-serif, system-ui, -apple-system,"Segoe UI",Roboto,"Noto Sans KR",Apple SD Gothic Neo,Arial,"Apple Color Emoji","Segoe UI Emoji"; color:var(--fg); background:var(--bg)}
    header{padding:20px 16px; border-bottom:1px solid #e2e8f0}
    header h1{margin:0; font-size:20px}
    main{max-width:980px; margin:0 auto; padding:20px 16px}
    .card{background:#fff; border:1px solid #e2e8f0; border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row > *{flex:1 1 240px}
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input[type=text], input[type=number]{width:100%; padding:12px 14px; border:1px solid #cbd5e1; border-radius:12px; font-size:16px}
    button{padding:10px 14px; border:1px solid #cbd5e1; border-radius:12px; background:var(--soft); cursor:pointer}
    button.primary{background:var(--accent); border-color:var(--accent); color:#fff}
    .hint{font-size:12px; color:var(--muted)}
    table{width:100%; border-collapse:collapse; margin-top:12px}
    th,td{border:1px solid #e2e8f0; padding:8px 10px; text-align:center}
    th{background:#f8fafc}
    .total{font-size:22px; font-weight:700; margin-top:12px}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
    .chip{background:#eef2ff; color:#3730a3; border-radius:999px; padding:6px 10px; font-size:12px}
    .muted{color:var(--muted)}
    .badge{display:inline-block; padding:8px 12px; border-radius:999px; font-weight:700}
    .badge.red{background:#fee2e2; color:#991b1b}
    .badge.yellow{background:#fef9c3; color:#854d0e}
    .badge.green{background:#dcfce7; color:#166534}
    .symgrid{display:grid; grid-template-columns:repeat(auto-fit, minmax(48px, 1fr)); gap:8px; margin-top:8px}
    .symbtn{display:flex; align-items:center; justify-content:center; font-size:22px; padding:10px; border:1px solid #cbd5e1; border-radius:12px; background:#f8fafc; cursor:pointer; user-select:none}
    .symbtn:hover{background:#eef2ff; border-color:#94a3b8}
    .symhint{font-size:12px; color:var(--muted); margin-top:4px}
    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:#111827; color:#fff; padding:10px 14px; border-radius:10px; opacity:0; transition:opacity .2s ease; pointer-events:none; z-index:9999}
    .toast.show{opacity:1}
    footer{padding:24px 16px; color:var(--muted); font-size:12px; text-align:center}
  </style>
</head>
<body>
  <header>
    <h1>ì›¹ ë‚±ë§ ì ìˆ˜ ê³„ì‚°ê¸° Â· 5ê¸€ì & ê¸°í˜¸ ì§€ì›</h1>
  </header>
  <main>
    <section class="card">
      <div class="row">
        <div>
          <label for="wordInput">ë‹¨ì–´/ë¬¸ìì—´ ì…ë ¥ (í•œê¸€ 5ê¸€ì + ê¸°í˜¸ëŠ” ì–´ë””ë“ )</label>
          <input id="wordInput" type="text" tabindex="1" placeholder="ì˜ˆ: íšƒë¶ˆì˜ì˜ë¯¸â˜…?" />
          <div class="hint">í•œê¸€ì€ ìµœëŒ€ 5ê¸€ìê¹Œì§€ë§Œ ê³„ì‚°í•˜ê³ , ê¸°í˜¸ëŠ” ëª‡ ê°œë“  ì…ë ¥ ê°€ëŠ¥í•´ìš”. (ìƒìœ„ 5ê°œ ê¸°í˜¸ë§Œ ì ìˆ˜ ì§‘ê³„)</div>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="primary" onclick="calc()">ê³„ì‚°í•˜ê¸°</button>
        <button onclick="resetAll()">ì´ˆê¸°í™”</button>
      </div>

      <!-- íŠ¹ìˆ˜ê¸°í˜¸ ë³µì‚¬ íŒ¨ë„ -->
      <div style="margin-top:16px">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap">
          <h3 style="margin:0; font-size:16px">íŠ¹ìˆ˜ê¸°í˜¸ ë³µì‚¬</h3>
          <div class="symhint">ì›í•˜ëŠ” ê¸°í˜¸ë¥¼ í´ë¦­í•˜ë©´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë¼ìš”. (ë¶™ì—¬ë„£ê¸° Ctrl/âŒ˜+V)</div>
        </div>
        <div class="symgrid" id="symGrid"></div>
      </div>
    </section>

    <!-- ê²Œì„ ì ìˆ˜ ì…ë ¥ -->
    <section class="card" style="margin-top:12px">
      <div class="row">
        <div>
          <label for="gameScore">ê²Œì„ ì ìˆ˜ (í˜„ì¥ í¬ì¸íŠ¸)</label>
          <input id="gameScore" type="number" tabindex="2" placeholder="ì˜ˆ: 1019" inputmode="numeric" />
          <div class="hint">ë¹„ìœ¨ = ê²Œì„ì ìˆ˜ Ã· ê³„ì‚°ì ìˆ˜ (ì•„ë˜ ê²°ê³¼ì—ì„œ ì‹ í˜¸ë“±ìœ¼ë¡œ í‘œì‹œ)</div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <h3 style="margin:6px 0 10px">ë¶„ì„ ê²°ê³¼</h3>
      <div id="limits" class="hint muted"></div>
      <div class="chips" id="symbols"></div>

      <table id="resultTable" style="display:none">
        <thead>
          <tr>
            <th>ìˆœë²ˆ</th>
            <th>ê¸€ì</th>
            <th>ì´ˆì„±</th>
            <th>ì¤‘ì„±</th>
            <th>ì¢…ì„±</th>
            <th>ì´ˆì„±ì ìˆ˜</th>
            <th>ì¤‘ì„±ì ìˆ˜</th>
            <th>ì¢…ì„±ì ìˆ˜</th>
            <th>í•©ê³„</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="symScoreWrap" style="margin-top:10px; display:none">
        <div class="hint">ê¸°í˜¸ ì ìˆ˜</div>
        <div id="symScoreList" class="chips"></div>
      </div>

      <div class="total" id="total" style="display:none"></div>

      <div id="ratioBox" style="display:none; margin-top:10px">
        <div id="ratioBadge" class="badge"></div>
      </div>
    </section>

    <section class="card" style="margin-bottom:12px; font-size:16px">
  <h3 style="margin:6px 0 10px">ì‚¬ìš© ë°©ë²•</h3>
  <ul style="margin:0 0 8px 18px; line-height:1.6">
    <li>ì…ë ¥ì°½ì— ë‹¨ì–´(í•œê¸€ ìµœëŒ€ 5ê¸€ì)ì™€ í•„ìš”í•œ ê¸°í˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</li>
    <li><b>Enter</b> â†’ ì ìˆ˜ ì…ë ¥ì¹¸ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</li>
    <li>ê²Œì„ ì ìˆ˜ ì…ë ¥ í›„ <b>Enter</b> â†’ ê³„ì‚°í•©ë‹ˆë‹¤.</li>
    <li>ê³„ì‚°ì´ ëë‚œ ë’¤ì—ëŠ” <b>ì–´ë””ì„œë“  Enter</b> â†’ ì´ˆê¸°í™”ë˜ê³  ë‹¨ì–´ ì…ë ¥ì¹¸ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</li>
  </ul>
  <div class="hint" style="margin-top:6px"><b>íŠ¹ìˆ˜ê¸°í˜¸ ì…ë ¥:</b> ì•„ë˜ â€˜íŠ¹ìˆ˜ê¸°í˜¸ ë³µì‚¬â€™ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í´ë¦½ë³´ë“œë¡œ ë³µì‚¬ë©ë‹ˆë‹¤. (ë¶™ì—¬ë„£ê¸° Ctrl/âŒ˜+V)</div>
  <div class="hint" style="margin-top:6px"><b>ê³„ì‚° ê·œì¹™:</b> í•œê¸€ì€ ìµœëŒ€ 5ê¸€ì, ê¸°í˜¸ëŠ” ìƒìœ„ 5ê°œë§Œ ì ìˆ˜ì— í¬í•¨ë©ë‹ˆë‹¤.</div>
  <div class="hint" style="margin-top:6px"><b>ì‹ í˜¸ë“± ê¸°ì¤€:</b> 0â€“2.0=ğŸ”´, 2.0â€“3.5=ğŸŸ¡, 3.5+=ğŸŸ¢</div>
</section>

    <section class="card" style="margin-top:16px">
      <details>
        <summary>ì ìˆ˜ ê·œì¹™ ìš”ì•½ ë³´ê¸°</summary>
        <div style="margin-top:8px">
          <div class="hint">ê° ë¬¶ìŒì˜ ì²« ë¬¸ì 1ì , ê°™ì€ ë¬¸ì 2ê°œë¥¼ í•©ì¹˜ë©´ ë‹¤ìŒ ë¬¸ì(ì ìˆ˜Ã—2). ë¬¶ìŒ ê°„ í•©ì„± ë¶ˆê°€.</div>
          <ul>
            <li>ììŒë°•ìŠ¤1-ë¬¶ìŒ1: ã„±â†’ã„´â†’ã„·â†’ã„¹â†’ã…â†’ã…‚â†’ã…… (1,2,4,8,16,32,64)</li>
            <li>ììŒë°•ìŠ¤1-ë¬¶ìŒ2: ã„²â†’ã„¸â†’ã…ƒâ†’ã…†â†’ã…‰ (1,2,4,8,16)</li>
            <li>ììŒë°•ìŠ¤2-ë‹¨ì¼: ã…‡â†’ã…ˆâ†’ã…Šâ†’ã…‹â†’ã…Œâ†’ã…â†’ã… (1,2,4,8,16,32,64)</li>
            <li>ììŒë°•ìŠ¤2-ê²¹1: ã„±ã……â†’ã„´ã…ˆâ†’ã„´ã… (1,2,4)</li>
            <li>ììŒë°•ìŠ¤2-ê²¹2: ã„¹ã„±â†’ã„¹ã…â†’ã„¹ã…‚â†’ã„¹ã…â†’ã„¹ã……â†’ã…‚ã…… (1,2,4,8,16,32)</li>
            <li>ëª¨ìŒë°•ìŠ¤1-1: ã…â†’ã…‘â†’ã…“â†’ã…• (1,2,4,8)</li>
            <li>ëª¨ìŒë°•ìŠ¤1-2: ã…â†’ã…’â†’ã…”â†’ã…– (1,2,4,8)</li>
            <li>ëª¨ìŒë°•ìŠ¤2-1: ã…—â†’ã…›â†’ã…œâ†’ã… â†’ã…¡â†’ã…£ (1,2,4,8,16,32)</li>
            <li>ëª¨ìŒë°•ìŠ¤2-2: ã…¢â†’ã…Ÿâ†’ã…â†’ã…â†’ã…šâ†’ã…˜â†’ã…™ (1,2,4,8,16,32,64)</li>
            <li>íŠ¹ìˆ˜ê¸°í˜¸-ë¬¶ìŒ1: ,â†’.â†’â‹¯â†’!â†’?â†’-â†’~â†’[â†’] (1,2,4,8,16,32,64,128,256)</li>
            <li>íŠ¹ìˆ˜ê¸°í˜¸-ë¬¶ìŒ2: â—†â†’â™¦â†’â™ â†’â™£â†’â™¥â†’â˜… (1,2,4,8,16,32)</li>
          </ul>
        </div>
      </details>
    </section>
  </main>

  <footer>Â© ë‚±ë§ ì ìˆ˜ ê³„ì‚°ê¸° â€“ ë¸Œë¼ìš°ì € ì „ìš©</footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
// ===== Hangul decomposition =====
const HANGUL_BASE = 0xAC00;
const CHO = ["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
const JUNG = ["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];
const JONG = ["", "ã„±","ã„²","ã„±ã……","ã„´","ã„´ã…ˆ","ã„´ã…","ã„·","ã„¹","ã„¹ã„±","ã„¹ã…","ã„¹ã…‚","ã„¹ã……","ã„¹ã…Œ","ã„¹ã…","ã„¹ã…","ã…","ã…‚","ã…‚ã……","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];

function decompose(syllable){
  const code = syllable.charCodeAt(0);
  const idx = code - HANGUL_BASE;
  if(idx < 0 || idx > 11171) return null; // not Hangul syllable
  const cho = Math.floor(idx / 588);
  const jung = Math.floor((idx % 588) / 28);
  const jong = idx % 28;
  return { cho: CHO[cho], jung: JUNG[jung], jong: JONG[jong] };
}

// ===== Scoring tables =====
function seqToMap(seq){ const m={}; seq.forEach((ch,i)=> m[ch] = 2**i ); return m; }
const SCORES = {
  ...seqToMap(["ã„±","ã„´","ã„·","ã„¹","ã…","ã…‚","ã……"]),
  ...seqToMap(["ã„²","ã„¸","ã…ƒ","ã…†","ã…‰"]),
  ...seqToMap(["ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"]),
  ...seqToMap(["ã„±ã……","ã„´ã…ˆ","ã„´ã…"]),
  ...seqToMap(["ã„¹ã„±","ã„¹ã…","ã„¹ã…‚","ã„¹ã…","ã„¹ã……","ã…‚ã……"]),
  ...seqToMap(["ã…","ã…‘","ã…“","ã…•"]),
  ...seqToMap(["ã…","ã…’","ã…”","ã…–"]),
  ...seqToMap(["ã…—","ã…›","ã…œ","ã… ","ã…¡","ã…£"]),
  ...seqToMap(["ã…¢","ã…Ÿ","ã…","ã…","ã…š","ã…˜","ã…™"]),
  ...seqToMap([",",".","â‹¯","!","?","-","~","[","]"]),
  ...seqToMap(["â—†","â™¦","â™ ","â™£","â™¥","â˜…"]),
};
function scoreOf(token){ return SCORES[token] ?? 0; }

// ===== Symbols copy panel =====
const SYMBOLS = ["â—†","â™¦","â™ ","â™£","â™¥","â˜…",",",".","â‹¯","!","?","-","~","[","]"];
function renderSymbols(){
  const grid = document.getElementById('symGrid');
  if(!grid) return;
  grid.innerHTML = '';
  SYMBOLS.forEach(s => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'symbtn';
    btn.title = s + ' ë³µì‚¬';
    btn.setAttribute('aria-label', s + ' ë³µì‚¬');
    btn.textContent = s;
    btn.onclick = () => copySym(s);
    grid.appendChild(btn);
  });
}
function copySym(s){
  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(s).then(()=> showToast(`${s} ë³µì‚¬ë¨`)).catch(()=> fallbackCopy(s));
  } else { fallbackCopy(s); }
}
function fallbackCopy(text){
  const ta = document.createElement('textarea');
  ta.value = text; document.body.appendChild(ta); ta.select();
  try{ document.execCommand('copy'); showToast(`${text} ë³µì‚¬ë¨`);}catch(e){ showToast('ë³µì‚¬ ì‹¤íŒ¨'); }
  document.body.removeChild(ta);
}
function showToast(msg){
  const el = document.getElementById('toast');
  if(!el) return; el.textContent = msg; el.classList.add('show');
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=> el.classList.remove('show'), 1400);
}

// ===== Calculator =====
let CALC_DONE = false;

function calc(){
  const input = document.getElementById('wordInput').value || '';
  const chars = Array.from(input);

  const hangulAll = chars.map(c => ({c, d: decompose(c)}));
  const hangul = [];
  const symbols = [];
  for(const item of hangulAll){
    if(item.d){ if(hangul.length < 5) hangul.push({ch:item.c, ...item.d}); }
    else { if(symbols.length < 5) symbols.push(item.c); }
  }

  const limits = document.getElementById('limits');
  const notes = [];
  if(hangul.length < hangulAll.filter(x=>x.d).length) notes.push('í•œê¸€ 5ê¸€ìê¹Œì§€ë§Œ ê³„ì‚°í–ˆì–´ìš”.');
  if(symbols.length < hangulAll.filter(x=>!x.d).length) notes.push('ê¸°í˜¸ëŠ” ìƒìœ„ 5ê°œë§Œ ì ìˆ˜ì— í¬í•¨í–ˆì–´ìš”.');
  limits.textContent = notes.join(' ');

  const tbody = document.querySelector('#resultTable tbody');
  tbody.innerHTML = '';
  let total = 0;
  hangul.forEach((h, idx)=>{
    const scCho = scoreOf(h.cho);
    const scJung = scoreOf(h.jung);
    const scJong = scoreOf(h.jong);
    const sc = scCho + scJung + scJong;
    total += sc;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${idx+1}</td>
      <td>${h.ch}</td>
      <td>${h.cho||''}</td>
      <td>${h.jung||''}</td>
      <td>${h.jong||''}</td>
      <td>${scCho}</td>
      <td>${scJung}</td>
      <td>${scJong}</td>
      <td>${sc}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('resultTable').style.display = hangul.length? 'table':'none';

  const symWrap = document.getElementById('symScoreWrap');
  const symList = document.getElementById('symScoreList');
  const symChips = document.getElementById('symbols');
  symChips.innerHTML = '';
  symList.innerHTML = '';
  let symTotal = 0;
  symbols.forEach(s=>{
    const chip1 = document.createElement('div'); chip1.className='chip'; chip1.textContent = s;
    symChips.appendChild(chip1);
    const sc = scoreOf(s); symTotal += sc;
    const chip2 = document.createElement('div'); chip2.className='chip'; chip2.textContent = `${s} = ${sc}`;
    symList.appendChild(chip2);
  });
  symWrap.style.display = symbols.length? 'block':'none';
  total += symTotal;

  const totalDiv = document.getElementById('total');
  totalDiv.textContent = `ì´ ì ìˆ˜: ${total.toLocaleString()}ì `;
  totalDiv.style.display = (hangul.length || symbols.length)? 'block':'none';

  const ratioBox = document.getElementById('ratioBox');
  const ratioBadge = document.getElementById('ratioBadge');
  const gameValRaw = document.getElementById('gameScore').value.trim();
  if(gameValRaw && total>0){
    const gameVal = Number(gameValRaw);
    if(!Number.isNaN(gameVal)){
      const r = gameVal / total;
      let cls = 'red';
      if(r >= 3.5) cls = 'green';
      else if(r >= 2) cls = 'yellow';
      ratioBadge.className = 'badge ' + cls;
      ratioBadge.textContent = `ê²Œì„ì ìˆ˜ ${gameVal.toLocaleString()} Ã· ê³„ì‚°ì ìˆ˜ ${total.toLocaleString()} = ë¹„ìœ¨ ${r.toFixed(1)}`;
      ratioBox.style.display = 'block';
    } else {
      ratioBox.style.display = 'none';
      ratioBadge.textContent = '';
    }
  } else {
    ratioBox.style.display = 'none';
    ratioBadge.textContent = '';
  }

  CALC_DONE = true;
}

function resetAll(){
  document.getElementById('wordInput').value = '';
  document.getElementById('gameScore').value = '';
  document.getElementById('resultTable').style.display = 'none';
  document.getElementById('symScoreWrap').style.display = 'none';
  document.getElementById('total').style.display = 'none';
  document.getElementById('symbols').innerHTML = '';
  document.querySelector('#resultTable tbody').innerHTML = '';
  document.getElementById('limits').textContent = '';
  document.getElementById('ratioBox').style.display = 'none';
  document.getElementById('ratioBadge').textContent = '';
  CALC_DONE = false;
}

// ===== Keyboard flow (fixed & continuous) =====
document.addEventListener('DOMContentLoaded', function(){
  renderSymbols();

  const wordInput  = document.getElementById('wordInput');
  const scoreInput = document.getElementById('gameScore');

  function isEnter(e){ return (e.key === 'Enter' || e.key === 'NumpadEnter'); }
  function focusWord(){ if(wordInput){ wordInput.focus(); wordInput.select?.(); } }

  // ìƒˆ ë‹¨ì–´ë¥¼ íƒ€ì´í•‘í•˜ëŠ” ìˆœê°„, ë‹¤ìŒ ë¼ìš´ë“œë¡œ ê°„ì£¼
  if (wordInput){
    wordInput.addEventListener('input', () => { CALC_DONE = false; });
    wordInput.addEventListener('keydown', function(e){
      if (e.isComposing) return;
      if (!isEnter(e)) return;
      e.preventDefault();
      CALC_DONE = false;                 // ìƒˆ ë¼ìš´ë“œ ì‹œì‘
      if (scoreInput) scoreInput.focus();
    });
  }

  if (scoreInput){
    scoreInput.addEventListener('keydown', function(e){
      if (e.isComposing) return;
      if (!isEnter(e)) return;
      e.preventDefault();
      if (!CALC_DONE){
        calc();                          // ì²« EnterëŠ” ê³„ì‚°
      } else {
        resetAll(); focusWord();         // ê³„ì‚° í›„ Enter â†’ ì´ˆê¸°í™” + ë‹¨ì–´ì¹¸
      }
    });
  }

  // ì „ì—­ í•¸ë“¤ëŸ¬(ë²„ë¸” ë‹¨ê³„): í¬ì»¤ìŠ¤ê°€ ì—‰ì¼œë„ ê³„ì‚° ì™„ë£Œ ìƒíƒœë¼ë©´ Enterë¡œ ì´ˆê¸°í™”
  document.addEventListener('keydown', function(e){
    if (e.isComposing) return;
    if (!isEnter(e)) return;
    // ì…ë ¥ì°½ì—ì„œì˜ EnterëŠ” ê°ì í•¸ë“¤ëŸ¬ê°€ ì²˜ë¦¬
    if (document.activeElement === wordInput || document.activeElement === scoreInput) return;

    if (CALC_DONE){
      e.preventDefault();
      resetAll(); focusWord();
    }
  }); // â† ìº¡ì²˜ ì‚¬ìš© ì•ˆ í•¨
});
</script>
</body>
</html>